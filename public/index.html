<!DOCTYPE html>
<html>
<head>
  <title>Scan to Login with PrivadoID</title>
  <style>
    body { font-family: Arial; padding: 20px; text-align: center; }
    img { margin: 20px auto; display: block; }
    #result { font-size: 1.2em; margin-top: 30px; }
  </style>
</head>
<body>
  <h2>Scan to Login with PrivadoID</h2>
  <div id="qr"></div>
  <pre id="json"></pre>
  <div id="result"></div>

  <script>
    async function fetchQR() {
      const res = await fetch('/api/request');
      const { qr, proofRequest } = await res.json();

      document.getElementById('qr').innerHTML = `<img src="${qr}" width="200"/>`;
      document.getElementById('json').textContent = JSON.stringify(proofRequest, null, 2);

      // Подписываемся на callback (имитация polling)
      const requestId = proofRequest.id;
      const interval = setInterval(async () => {
        const res = await fetch(`/status/${requestId}`);
        if (res.ok) {
          const { verified } = await res.json();
          clearInterval(interval);
          document.getElementById('result').textContent = verified
            ? '✅ Вы старше 18 лет!'
            : '❌ Верификация не пройдена';
        }
      }, 2000);
    }

    fetchQR();
  </script>
</body>
</html>
